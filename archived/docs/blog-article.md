# 50元充值两天用完？我花2天自研Gemini API，省下每年几万块

> 一次"吃苦"换来永久免费：从被平台薅羊毛到掌握技术主动权的逆向工程实战

---

## 🎯 项目背景：一次充值50元，两天用完的心痛

### 被"薅羊毛"的经历

作为一名开发者，我每天都在使用AI工具辅助编码。某天，我在某平台充值了**50元人民币**，想着应该够用一阵子了。

**结果呢？两天就用完了。**

主要消耗在：
- **写代码时的频繁对话**：使用Gemini Pro，每次调试、重构、优化都要问几轮
- **写技术博客配图**：3篇文章，每篇8张配图，共24张。平台收费**¥0.25/张**，看着不贵，但24张就是**6元**
- **不小心的大坑**：某次用了咸鱼平台的生图服务，刚上线时收费**¥1.5/张**。我没注意价格，一口气生成了几十张图，瞬间几十块没了

### 平台商家的"黑"：从怀疑到愤怒

**最开始，我也怀疑自己搞不定**。问了很多人，他们都说"没有开发能力，只能用第三方"。于是我纠结了好几天，试了一圈咸鱼、淘宝上的AI API服务。

**用了一个月后，我愤怒了。**

#### 🎭 骗术1：计费不透明，想怎么扣就怎么扣

- **宣传**："便宜！1元一刀"、"几元一刀"，"按次收费，不限长度"
- **实际**：计费混乱，规则随意改
- **套路**：说是按"次"收费，实际按token算；或者今天按次，明天突然按token

**我的真实经历**：
某平台宣传"按次收费"，我冲着这个去的。结果：
- **第一天**：一次对话¥0.1，很便宜，我很开心
- **第二天**：同样的对话突然扣¥2
- **问客服**："我们调整了计费规则，现在按token算"
- **我**："为什么不提前通知？"
- **客服**："公告发了，你没看到不怪我们"

**更离谱的**：
有些平台说"按次收费"，但他们的"次"是什么标准？
- 500字以内 = 1次
- 501-1000字 = 2次
- 1001-2000字 = 4次
- **你根本不知道会扣多少钱！**

#### 🎭 骗术2：偷换模型（最恶心）

**这是我最近发现的，不止一家在做！**

前几天用某平台的"Claude Opus 4.5"写代码，感觉输出质量明显不对劲：
- 代码风格不像Claude
- 错误率异常高
- 推理逻辑很弱

**我测试后发现**：他们用**国产的MiniMax和GLM-4偷换了Claude Opus 4.5**！

是哪家？我就不说了，**大家自行去猜**。但这绝不是个例，我发现**不止一家**在这么干。

**他们的逻辑**：
- 进货价：国产模型¥0.01/1K tokens
- 卖出价：按Claude价格¥0.5/1K tokens收费
- 利润：50倍！

而用户根本不知道，以为自己在用Claude。

#### 🎭 骗术3：不稳定 + 层层转包

- **不稳定**：今天能用，明天就503
- **层层转包**：大部分平台不是源头，都是对接第三方的第三方，每一层都要抽成
- **跑路风险**：你充值的钱，说不定哪天就没了

**最讽刺的是**：这些平台宣传"比官方便宜"，但实际使用下来，**一个月轻松烧掉几百块，还不如直接用官方**。

### 真实成本计算（以我的使用场景为例）

| 使用场景 | 频率 | 单价 | 月度成本 | 年度成本 |
|---------|------|------|---------|---------|
| **编码对话(Gemini Pro)** | 50元/2天 | - | ¥750 | ¥9,000 |
| **技术博客配图** | 3篇/月，8图/篇 | ¥0.25/张 | ¥6 | ¥72 |
| **误用高价生图** | 偶尔踩坑 | ¥1.5/张 | ¥30 | ¥360 |
| **Gemini 3思考模型** | 复杂问题 | - | ¥200 | ¥2,400 |
| **总计** | - | - | **¥986** | **¥11,832** |

**折合美元：约$1,600+/年**

看到这个数字，我意识到：**再这样下去，一年光AI服务就要花掉一万多人民币**。

### 为什么选择Gemini？

在被第三方平台坑了之后，我对比了市面上的主流AI服务：

| 模型 | 官方价格 | 第三方价格 | 效果评价 | 综合评分 |
|-----|---------|-----------|---------|---------|
| **Gemini 3.0 Pro** | 免费（Web） | ¥750/月 | ⭐⭐⭐⭐⭐ | 性价比之王 |
| Claude Opus 4.5 | $15/1M tokens | 经常被偷换 | ⭐⭐⭐⭐⭐ | 效果最强但最贵 |
| GPT-5.2 | $8/1M tokens | ¥1.5-3/1M tokens | ⭐⭐⭐⭐⭐ | 新一代，强大但贵 |
| GPT-4o | $5/1M tokens | ¥1/1M tokens | ⭐⭐⭐⭐ | 稳定主力 |
| MiniMax/GLM-4 | ¥0.01/1K tokens | - | ⭐⭐⭐ | 便宜但效果差 |

**结论**：
- **Gemini综合性价比最高**（免费 vs ¥750/月）
- 效果比Gemini差的模型，第三方平台价格反而是Gemini的几倍
- GPT-5.2和Claude Opus 4.5效果强大，但成本太高（GPT-5.2: $8/1M tokens，Claude: $15/1M tokens）
- 第三方平台还经常偷换模型（标价Claude，实际MiniMax）

### 技术探索历程：从API Key到Cookie方案

#### 第一阶段：尝试API Key轮询（失败）

最开始，我尝试了网上流传的"API Key轮询"方案：

**方案原理**：
- Google AI Studio提供免费API Key
- 理论上可以通过轮询多个Key来突破配额限制
- 社区有`gemini-balance`、`gpt-load`等项目

**残酷现实**：
```
❌ 2025年末开始，Google升级了风控策略
❌ 免费API Key必须绑定付费账户才能使用
❌ API Key轮询方案彻底失效
❌ gemini-balance和gpt-load等项目已无法使用
```

**我还尝试了GCP账户薅羊毛**：

有人说可以用GCP（Google Cloud Platform）新账户的免费额度薅羊毛：
- GCP新账户有$300免费额度
- 理论上可以注册多个账户轮换使用

**我的尝试**：
1. 注册了5个GCP账户
2. 每个账户都激活了$300免费额度
3. 配置好API Key，开始使用

**结果**：
- **第1个账户**：用了3天，被封
- **第2个账户**：用了2天，被封
- **第3-5个账户**：刚激活就被封

**Google的检测机制**：
- IP地址关联检测
- 设备指纹识别
- 使用模式异常检测
- **一旦被标记，关联账户全部封禁**

**教训**：
> **GCP账户薅羊毛完全不可行！**
>
> **Google的风控比你想象的强大得多。**
>
> **我损失了几个账户，还浪费了一周时间。**

**我的尝试**：
1. 注册了10个Google账号
2. 申请了10个免费API Key
3. 配置好轮询脚本
4. **结果**：所有Key都提示"Please enable billing"（请开通计费）

**Google的新政策**：
- 免费API Key仅限测试用途
- 必须绑定信用卡并开通计费
- 即使不使用，也要绑定付费账户

**官方付费方案价格**：

| 方案 | 价格 | 包含内容 | 限制 |
|------|------|---------|------|
| **免费版** | NT$0/月 | 3 Flash部分功能 | ⚠️ API Key需绑定付费账户 |
| **Google AI Pro** | NT$650/月 (约¥150) | 3 Pro完整权限 | ⚠️ 每月1,000点AI点数 |
| **Google AI Ultra** | NT$8,150/月 (约¥1,900) | 最高权限 | ⚠️ 每月25,000点AI点数 |

**成本核算**：

1. **API Key轮询方案**（已失效）：
   - ❌ 免费账号无法使用API Key（必须绑定付费）
   - 如果想用API Key，必须每个账号绑定信用卡并开通计费
   - 10个账号 = 10张信用卡 + 10个付费账户
   - **完全不可行！**

2. **官方付费方案**：
   - **AI Pro**: ¥150/月 = ¥1,800/年
   - **限制**: 每月1,000点AI点数用完就没了
   - 对于高频使用者（编码、写作），1,000点远远不够
   - **Ultra方案**: ¥1,900/月 = ¥22,800/年 😱

3. **我的真实需求**：
   - 每天编码对话：~100次请求
   - 每月博客配图：~24张
   - 如果用AI Pro：1,000点/月根本不够用
   - 如果用Ultra：一年2万多，太贵了！

#### 第二阶段：Cookie逆向方案（成功）

在API Key方案走不通后，我换了个思路：

**寻找现成方案（失败）**：
我先在GitHub、Reddit、V2EX上找了一圈，想看看有没有现成的Cookie逆向方案。

**结果**：
- ❌ 没有找到可用的开源项目
- ❌ 有一些讨论贴，但没有完整实现
- ❌ 少数几个项目已经过时或失效

**顿悟时刻**：
那天晚上，我盯着Gemini网页版想：

> **既然找不到现成的，那就自己动手！**
>
> **Gemini Web版是免费的，为什么不能让程序"假装"是浏览器访问？**
>
> **买别人的服务，不如自己研发一次。**
>
> **吃一次苦，不用以后年年受累。**

于是我开始研究新方案：
1. ✅ Gemini Web版本身是免费的，为什么API要收费？
2. ✅ 能不能用浏览器的Cookie，让程序"假装"是网页访问？
3. ✅ 如果成功了，是不是就能**永久免费**使用Gemini？
4. ✅ 这个方案会不会也像API Key一样被封杀？

**经过2天的逆向工程和调试**，我成功了。现在，这套系统已经稳定运行了一个月，**完全零成本**。

#### 三种方案全面对比

| 维度 | API Key轮询 | 官方付费方案 | Cookie逆向方案 |
|------|-----------|------------|---------------|
| **可行性** | ❌ 已失效 | ✅ 可用 | ✅ 可用 |
| **年度成本** | - | ¥1,800 - ¥22,800 | ¥0 |
| **配额限制** | - | 1,000-25,000点/月 | 无明显限制 |
| **高频使用** | - | ❌ 点数不够 | ✅ 够用 |
| **稳定性** | Google已封杀 | ✅ 官方保障 | 稳定运行1个月+ |
| **风险** | - | 无 | 账号可能被封（风险较低） |
| **技术难度** | 简单 | 最简单 | 中等（需逆向） |
| **维护成本** | - | 无 | 低（每月更新Cookie） |

**核心结论**：
- **官方AI Pro (¥150/月)**：看似便宜，但1,000点/月不够用
- **官方AI Ultra (¥1,900/月)**：点数够用，但一年2万多太贵
- **Cookie逆向**：完全免费 + 无限制使用 = **目前市场上唯一可行的高频免费方案**

**为什么Cookie方案更可行？**

1. **Google的商业逻辑**：
   - API = 商业产品，必须付费（风控严格）
   - Web版 = 用户产品，免费使用（风控宽松）

2. **检测难度**：
   - API Key：容易检测轮询行为
   - Cookie：模拟正常浏览器行为，难以区分

3. **历史教训**：
   - 2025年末：API Key轮询方案被封杀
   - 2025年12月：Cookie方案依然可用（已稳定运行1个月）

**风险提示**：
- ⚠️ Cookie方案也可能在未来被Google封杀
- ⚠️ 但目前是**市场上唯一可行的高频免费方案**
- ⚠️ 建议仅个人使用，不要大规模滥用

### ⚠️ 重要声明：为什么只能交流思路

**必须坦诚地说**：

1. **这是违反Google政策的**
   - 违反了Gemini的服务条款
   - 如果Google发现，可能会升级安全措施
   - 可能导致账号被封

2. **所以我只能分享思路，无法提供完整代码**
   - 核心认证逻辑保持私有
   - 仅开源Web界面和API结构
   - 技术交流为主，使用风险自负

3. **为什么还要写这篇文章？**
   - 揭露第三方平台的骗术
   - 帮助独立开发者掌握思路
   - 分享技术突破的过程

**如果你决定尝试**：
- ✅ 仅用于个人学习和研究
- ✅ 不要大规模公开服务
- ✅ 理解并接受账号风险
- ❌ 绝不用于商业用途

本文将分享技术思路和架构设计，希望能帮到和我一样的独立开发者。

---

## 🏗️ 技术架构

### 核心设计思路

```
┌─────────────┐
│  用户应用   │
│  (Postman/  │
│   Custom    │
│   Client)   │
└──────┬──────┘
       │ HTTP/REST
       ▼
┌─────────────────────────────┐
│   FastAPI Gateway (Python)  │
│  ┌─────────────────────┐   │
│  │ 模型路由管理器      │   │
│  ├─────────────────────┤   │
│  │ Cookie认证中间件    │   │
│  ├─────────────────────┤   │
│  │ 提示词优化器        │   │
│  └─────────────────────┘   │
└──────────┬──────────────────┘
           │
           ▼
    ┌──────────────┐
    │  Gemini Web  │
    │   Interface  │
    └──────────────┘
```

### 技术栈选择

| 层级 | 技术 | 选择理由 |
|-----|------|---------|
| **后端** | FastAPI | 高性能异步框架，自带API文档 |
| **认证** | Cookie复用 | 绕过API Key限制 |
| **前端** | Vue 3 | 轻量级，易于部署 |
| **部署** | Docker | 环境隔离，快速部署 |
| **反向代理** | Caddy | 自动HTTPS，配置简单 |

---

## 💡 核心技术突破

### 1. Cookie认证机制

传统API需要付费获取API Key，而我们的方案通过**复用浏览器Cookie**实现免费访问：

```python
# 核心思路（简化版）
class GeminiGateway:
    def __init__(self):
        self.session = httpx.AsyncClient()

    async def authenticate(self, cookies: dict):
        """使用浏览器Cookie进行认证"""
        self.session.cookies.update(cookies)
        # 验证Cookie有效性
        response = await self.session.get("https://gemini.google.com/...")
        return response.status_code == 200
```

**关键要点**：
- 核心认证Token（必需）
- 会话安全验证Cookie
- 时间戳验证Cookie（约30天有效期）

**注意**：具体Cookie名称和参数不便公开，需要自行研究。

### 2. 模型路由管理

Gemini提供了多个模型，我们需要智能路由：

```python
MODEL_MAP = {
    "gemini-2.5-flash": "快速模型",      # 日常对话
    "gemini-2.5-pro": "专业模型",        # 代码和数学
    "gemini-3.0-pro": "思考模型",        # 复杂推理（带思考链）
}

async def route_request(prompt: str, model: str):
    """根据模型选择路由到不同的Gemini后端"""
    # 实际实现包含更复杂的路由逻辑
    pass
```

**发现**：通过检测 `response.thoughts` 字段，可以识别是否使用了高级思考模型（Nano Banana Pro）。

### 3. 中文提示词优化

在实际使用中发现，**纯中文提示词会被Gemini误识别为对话请求**，导致图片生成失败。解决方案：

```python
def optimize_image_prompt(prompt: str) -> str:
    """自动优化图片生成提示词"""
    # 检测是否包含中文
    if contains_chinese(prompt):
        # 如果没有明确的图片生成指令，添加前缀
        if not has_image_keywords(prompt):
            return f"Create an image: {prompt}"
    return prompt

# 使用示例
# 输入: "一只可爱的橘猫"
# 输出: "Create an image: 一只可爱的橘猫"
# ✅ 成功生成图片
```

这个优化让中文提示词的图片生成成功率从 **30%** 提升到 **95%+**。

### 4. Docker容器化部署

为了确保环境一致性和快速部署，使用Docker：

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# 安装依赖
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 复制应用代码
COPY . .

# 暴露端口
EXPOSE 8100

# 启动应用
CMD ["uvicorn", "api_server:app", "--host", "0.0.0.0", "--port", "8100"]
```

**重要配置**：
- Volume挂载：确保Cookie配置持久化
- 健康检查：自动重启失败的容器
- 资源限制：避免内存溢出

---

## 🔥 踩坑实录：从0到1的血泪史

### 坑1：中文提示词不生成图片（最坑）

**现象**：
输入"一只可爱的橘猫"，返回的是**文字描述**而不是图片：
```
"这是一些可爱的橘猫图片：
http://googleusercontent.com/image1.jpg
http://googleusercontent.com/image2.jpg
..."
```

而 `response.images` 却是空的！

**调试过程**：
1. ❌ 怀疑Cookie过期 → 重新导入Cookie，依然失败
2. ❌ 怀疑模型选择错误 → 切换Flash/Pro/Pro 3.0，都失败
3. ❌ 怀疑提示词格式 → 尝试各种格式，都失败
4. ✅ **发现真相**：英文提示词"a cute orange cat"竟然成功了！

**原因**：
Gemini Web界面的语言识别逻辑：
- 英文 + 图片意图 → 调用Imagen模型生成图片
- 中文 + 图片意图 → 误认为是对话请求，返回文本链接

**解决方案**：
自动检测中文并添加"Create an image:"前缀
```python
if any('\u4e00' <= c <= '\u9fff' for c in prompt):
    if not has_image_keywords(prompt):
        prompt = f"Create an image: {prompt}"
```

**效果**：成功率从30%提升到95%+

---

### 坑2：图片下载403 Forbidden

**现象**：
图片URL拿到了，但是下载时报403错误。

**原因**：
Google的图片URL需要**带Cookie认证**才能访问，直接HTTP GET会被拒绝。

**解决方案**：
从 `GeneratedImage` 对象中提取cookies并传递给HTTP客户端：
```python
img_cookies = getattr(img, 'cookies', None) or {}
async with httpx.AsyncClient(follow_redirects=True, cookies=img_cookies) as client:
    resp = await client.get(img.url, timeout=30.0)
```

**教训**：逆向工程不能只看URL，还要看**认证上下文**。

---

### 坑3：容器重启后Cookie丢失

**现象**：
Docker容器重启后，Web界面提示"客户端未初始化"。

**原因**：
Cookie存储在内存中，容器重启后数据丢失。

**临时方案**：
Web界面支持快速重新导入cookies.txt（30秒搞定）。

**长期方案**：
- [ ] 实现Cookie持久化到Volume
- [ ] 定时自动刷新Cookie
- [ ] 多账号轮询备份

**现状**：
因为Cookie有30天有效期，每月更新一次可以接受，暂未实现自动持久化。

---

### 坑4：误以为"gemini-3-pro-image-preview"存在

**现象**：
在某些逆向平台看到"gemini-3-pro-image-preview"这个模型名，以为官方有专门的图片模型。

**真相**：
官方API文档根本没有这个专用图片模型！实际上只有通用的文本模型：
- Flash模型（快速）
- Pro模型（专业）
- Pro 3.0模型（高级）

**发现**：
所有文本模型在生成图片时，都会自动路由到**Google Imagen**后端，模型选择不影响图片质量。

**教训**：
逆向平台的"营销包装"不可信，要以实际测试为准。

---

### 坑5：咸鱼商家的"黑" - 偷换模型实锤

**真实经历**：

#### 1. 计费混乱，规则随意改

- **宣传**："按次收费，不限长度"、"1元一刀"
- **实际第一天**：一次对话¥0.1，很便宜
- **实际第二天**：同样的对话突然扣¥2
- **问客服**："我们调整了计费规则，现在按token算"
- **套路**：说是按次，实际按token；或者今天按次，明天突然改规则

**更离谱的**：
- 500字以内 = 1次
- 501-1000字 = 2次
- 1001-2000字 = 4次
- **你根本不知道会扣多少钱！**

#### 2. 偷换模型（我抓到了实锤）

**最近用某平台的"Claude Opus 4.5"写代码，感觉不对劲**：

| 真实Claude Opus 4.5 | 某平台的"Claude" |
|--------------------|-----------------|
| 代码风格优雅，注释详细 | 代码风格混乱 |
| 推理逻辑强 | 推理逻辑弱 |
| 错误率低 | 错误率高 |
| 会主动优化代码 | 只能简单实现 |

**我测试后发现**：他们用**国产MiniMax/GLM-4偷换了Claude Opus 4.5**！

**他们的利润**：
- 进货价（国产模型）：¥0.01/1K tokens
- 卖出价（按Claude收费）：¥0.5/1K tokens
- **利润：50倍！**

**是哪家？我不说，大家自行去猜。但这不是个例，我发现不止一家在干。**

#### 3. 生图暴利 + 服务不稳定

- **生图刚上线时**：某平台¥1.5/张，我没注意价格，一觉醒来几十块没了
- **服务不稳定**：今天能用，明天503，联系客服"服务器升级中"
- **跑路风险**：等了一周，直接跑路

#### 4. 从怀疑到愤怒的心路历程

**最开始**：我也怀疑自己搞不定，问了很多人，他们说"没开发能力，只能用第三方"

**用了一个月后**：愤怒了！乱扣费、偷换模型、效果差

**下定决心**：
> **与其年年被割韭菜，不如花2天时间掌握核心技术。**
>
> **吃一次苦，省几万块，还能揭露这些骗子的套路。**

---

## 🎨 Web管理界面

开发了一个现代化的管理界面，支持：

### 核心功能

1. **Cookie管理**
   - 支持3种导入方式：表单/JSON/cookies.txt
   - 实时验证Cookie有效性
   - 自动提示过期时间

2. **模型切换**
   - 可视化选择3种模型
   - 显示模型特性和适用场景
   - "新"标签标注最新模型

3. **测试工具**
   - 文本生成测试
   - 图片生成测试（支持1-4张）
   - 实时显示生成进度

### UI设计

```css
/* 核心设计理念 */
- 深色主题（保护眼睛）
- 渐变色按钮（Google配色）
- 响应式布局（移动端友好）
- 流畅动画（提升体验）
```

---

## 📊 性能与成本对比

### 性能测试结果

| 指标 | Google官方API | 私有网关 | 对比 |
|-----|-------------|---------|------|
| 文本生成速度 | ~2s | ~3s | 稍慢50% |
| 图片生成速度 | ~8s | ~10s | 稍慢25% |
| 并发支持 | 高 | 中等 | 受限于Cookie |
| 可用性 | 99.9%+ | 95%+ | 依赖Cookie有效期 |

### 成本对比：真实使用场景

**第三方平台方案（我之前用的）**：
```
月度成本:
├─ 编码对话(Gemini Pro): ¥750 (50元/2天)
├─ 博客配图(24张/月): ¥6 (¥0.25/张)
├─ 误用高价生图: ¥30 (¥1.5/张)
├─ Gemini 3思考模型: ¥200
└─ 月度总计: ¥986

年度总计: ¥11,832 ($1,600+)
```

**官方API方案（理想情况）**：
```
年度成本:
├─ Gemini Pro API: $480
├─ 图片生成API: $300
├─ 高级模型: $216
└─ 总计: $996

问题: 国内访问困难，需要代理
```

**私有网关方案（现在）**：
```
开发成本:
├─ 开发时间: 2天 × 8小时 = 16小时
├─ 学习成本: 逆向工程 + FastAPI + Docker
└─ 一次性投入: ~¥0（利用业余时间）

运行成本:
├─ 服务器: $0 (复用现有服务器)
├─ Cookie维护: $0 (免费Gemini账号)
├─ 维护时间: 5分钟/月 (更新Cookie)
└─ 年度总成本: $0

💰 投资回报:
- 第一年: 省¥11,832
- 第二年: 省¥11,832
- 第三年: 省¥11,832
- 三年累计: 省¥35,496 ($5,000)
```

**真实感受**：
- **之前**：充值50元，两天用完，提心吊胆不敢多用
- **现在**：想用就用，完全免费，心理压力为零

---

## ⚠️ 风险与应对

### 1. Cookie过期问题

**问题**：某些关键Cookie约30天过期

**解决方案**：
- 设置日历提醒，每月15日更新
- Web界面支持一键导入新Cookie
- 定期备份Cookie配置文件

### 2. 账号风险

**问题**：大量请求可能触发Google风控

**应对措施**：
- 添加速率限制（10请求/分钟）
- 避免高峰时段密集请求
- 仅个人使用，不公开服务

### 3. API变更

**问题**：Google可能修改Web接口

**解决方案**：
- 关注技术社区的更新和反馈
- 定期测试功能是否正常
- 准备降级到官方API的备选方案

---

## 🚀 部署指南

### 快速开始

```bash
# 1. 克隆仓库（开源部分）
git clone https://github.com/yourusername/gemini-gateway
cd gemini-gateway

# 2. 配置环境变量
cp .env.example .env
# 编辑 .env，填入Cookie

# 3. Docker部署
docker-compose up -d

# 4. 访问Web界面
open http://localhost:8100
```

### 生产环境配置

```yaml
# docker-compose.yml
version: '3.8'
services:
  gemini-gateway:
    build: .
    ports:
      - "8100:8100"
    volumes:
      - ./data:/app/data  # 持久化Cookie
    environment:
      - LOG_LEVEL=INFO
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8100/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

---

## 📈 实际使用案例

### 案例1: 日常开发辅助

```python
# 使用私有API进行代码审查
import httpx

async def review_code(code: str):
    response = await httpx.post(
        "http://localhost:8100/v1/generate",
        json={
            "prompt": f"请审查以下代码并提供优化建议：\n{code}",
            "model": "gemini-2.5-pro"
        }
    )
    return response.json()["text"]
```

### 案例2: 批量图片生成

```python
# 为产品生成多个配图
prompts = [
    "科技感的数据中心内部",
    "现代化的办公空间",
    "简约风格的产品展示"
]

for prompt in prompts:
    response = await httpx.post(
        "http://localhost:8100/v1/generate-images",
        json={
            "prompt": prompt,
            "model": "gemini-2.5-flash",
            "count": 4
        }
    )
    # 保存图片...
```

**月度使用统计**：
- 文本生成：~2000次
- 图片生成：~300张
- 节省成本：~$83/月

---

## 🎓 技术收获

### 1. 逆向工程实践

- 学习了如何分析浏览器网络请求
- 理解了Cookie认证的底层机制
- 掌握了API协议的逆向分析方法

### 2. 全栈开发经验

- FastAPI异步编程实践
- Vue 3现代前端开发
- Docker容器化部署
- Nginx/Caddy反向代理配置

### 3. 问题解决能力

- 中文提示词失败 → 自动添加英文前缀
- Cookie过期 → Web界面快速更新
- 容器重启丢失数据 → Volume持久化

---

## 🔮 未来规划

### 短期（1-3个月）

- [ ] 添加对话历史管理
- [ ] 支持流式响应（SSE）
- [ ] 实现多用户隔离
- [ ] 添加使用量统计面板

### 中期（3-6个月）

- [ ] 支持Claude等其他AI模型
- [ ] 开发CLI工具
- [ ] 集成向量数据库（RAG）
- [ ] 提供插件系统

### 长期（6-12个月）

- [ ] 构建AI应用生态
- [ ] 开放部分商业化服务
- [ ] 社区版与企业版分离

---

## 💬 社区与反馈

### 如何参与

虽然核心逆向代码不开源（出于安全考虑），但欢迎在以下方面参与：

1. **前端界面优化** - 完全开源
2. **文档改进** - 持续更新
3. **使用案例分享** - 欢迎投稿
4. **Bug反馈** - GitHub Issues

### 讨论渠道

- GitHub: [项目地址]
- Twitter: [@your_handle]
- 博客: [你的博客]

---

## 📝 总结：为什么我要做这件事

### 经济账：年省1万2，值得吗？

花2天时间研发，换来每年节省**¥11,832**。

- 第一年：回本
- 第二年：纯赚¥11,832
- 第三年：纯赚¥11,832
- ...

**三年累计节省：¥35,496（约$5,000）**

这还不包括"被坑"的隐性成本：
- 不再担心平台跑路
- 不再担心价格突然涨价
- 不再担心服务质量波动

### 技术账：掌握核心竞争力

这个项目让我学会了：
- ✅ **逆向工程思维**：如何分析和复现Web API
- ✅ **全栈开发能力**：FastAPI + Vue 3 + Docker
- ✅ **系统设计经验**：Cookie管理、模型路由、错误处理
- ✅ **问题解决能力**：中文提示词优化、图片下载认证

**这些技能的价值，远超1万块钱。**

### 心态账：从被动到主动

**最大的收获不是省钱，而是心态的转变**：

| 之前（被动） | 之后（主动） |
|------------|------------|
| 平台涨价，我只能接受 | 技术在手，无所畏惧 |
| 担心账号被封，提心吊胆 | 自己的系统，随时恢复 |
| 不敢多用，怕烧钱 | 想用就用，完全免费 |
| 依赖别人的服务 | 掌握核心技术 |

**这种掌控感，是用钱买不来的。**

### 给独立开发者的建议

如果你也在为AI服务成本发愁，我的建议是：

1. **算清楚账**：你一年真实花费多少？（不要低估）
2. **评估投入产出比**：花多少时间能自研？值得吗？
3. **吃一次苦**：2天的时间换来永久免费，值！
4. **开源精神**：技术应该共享，让更多人受益

**最重要的是**：
> 不要把自己的核心需求交给别人控制。
>
> 技术人最大的优势，就是能自己解决问题。
>
> 吃一次苦，不用年年受累。

### 后续计划

这个项目还在持续优化中：
- [ ] 多账号配置和轮询（避免单点故障）
- [ ] 接入new-api作为自定义渠道
- [ ] 更完善的监控和日志系统
- [ ] 社区贡献和用户反馈集成

**如果你觉得有帮助，欢迎Star ⭐ 和分享！**

---

## ⚠️ 免责声明

**本项目仅供学习和研究目的，使用风险自负。**

- ❌ 禁止商业使用
- ❌ 禁止大规模公开服务
- ⚠️ 可能违反Google服务条款
- ⚠️ Cookie可能随时失效

**使用本方案即表示你理解并接受以上风险。**

---

## 📚 参考资源

- [FastAPI官方文档](https://fastapi.tiangolo.com/)
- [Docker最佳实践](https://docs.docker.com/develop/dev-best-practices/)
- [Vue 3指南](https://vuejs.org/guide/)
- [Gemini官方文档](https://ai.google.dev/)

---

**作者**: Mason
**发布时间**: 2025-12-18
**项目地址**: [GitHub - Gemini Gateway (Public Parts)](链接待补充)
**许可证**: MIT (开源部分) / Proprietary (核心逆向代码)

---

**觉得有帮助？欢迎 Star ⭐ 和分享！**
