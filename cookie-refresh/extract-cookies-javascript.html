<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gemini Cookie æå–å™¨</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        .success {
            background: #e8f5e9;
            border-left-color: #4CAF50;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background: #1976D2;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .cookie-info {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .cookie-name {
            font-weight: bold;
            color: #2196F3;
        }
        .cookie-value {
            word-break: break-all;
            color: #666;
            margin: 5px 0 15px 0;
        }
        .instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸª Gemini Cookie æå–å™¨</h1>
        <p>ä»å½“å‰ç½‘é¡µä¸­æå–Geminiæ‰€éœ€çš„Cookie</p>

        <div class="instructions">
            <strong>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <ol>
                <li>åœ¨BitBrowserä¸­è®¿é—® <code>gemini.google.com</code></li>
                <li>ç¡®ä¿å·²æˆåŠŸç™»å½•å¹¶èƒ½æ­£å¸¸å¯¹è¯</li>
                <li>å°†æ­¤HTMLæ–‡ä»¶æ‹–åˆ°BitBrowseræµè§ˆå™¨ä¸­æ‰“å¼€</li>
                <li>ç‚¹å‡»ä¸‹æ–¹"æå–Cookie"æŒ‰é’®</li>
                <li>å¤åˆ¶ç”Ÿæˆçš„cookies.txtå†…å®¹</li>
                <li>è¿è¡Œéƒ¨ç½²è„šæœ¬æˆ–æ‰‹åŠ¨æ›´æ–°æœåŠ¡å™¨</li>
            </ol>
        </div>

        <button onclick="extractCookies()">ğŸ” æå– Cookie</button>

        <div id="status"></div>
        <div id="cookieInfo"></div>

        <div id="cookiesTxt" style="display: none;">
            <h3>cookies.txt æ ¼å¼</h3>
            <textarea id="cookiesTxtContent" readonly></textarea>
            <button onclick="copyToClipboard()">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
        </div>
    </div>

    <script>
        function extractCookies() {
            const statusDiv = document.getElementById('status');
            const cookieInfoDiv = document.getElementById('cookieInfo');
            const cookiesTxtDiv = document.getElementById('cookiesTxt');
            const cookiesTxtContent = document.getElementById('cookiesTxtContent');

            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            statusDiv.innerHTML = '';
            cookieInfoDiv.innerHTML = '';

            // è·å–æ‰€æœ‰Cookie
            const allCookies = document.cookie;

            if (!allCookies) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ æœªæ‰¾åˆ°ä»»ä½•Cookieã€‚è¯·ç¡®ä¿ï¼š<br>1. åœ¨gemini.google.comåŸŸåä¸‹æ‰“å¼€æ­¤é¡µé¢<br>2. å·²æˆåŠŸç™»å½•Gemini';
                return;
            }

            // è§£æCookie
            const cookieObj = {};
            allCookies.split(';').forEach(cookie => {
                const [name, value] = cookie.trim().split('=');
                cookieObj[name] = value;
            });

            // æ£€æŸ¥å¿…éœ€çš„Cookie
            const requiredCookies = ['__Secure-1PSID', '__Secure-1PSIDCC', '__Secure-1PSIDTS'];
            const foundCookies = {};
            const missingCookies = [];

            requiredCookies.forEach(name => {
                if (cookieObj[name]) {
                    foundCookies[name] = cookieObj[name];
                } else {
                    missingCookies.push(name);
                }
            });

            // æ˜¾ç¤ºç»“æœ
            if (missingCookies.length > 0) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `âŒ ç¼ºå°‘å¿…éœ€çš„Cookie: ${missingCookies.join(', ')}<br><br>` +
                    `<strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>` +
                    `1. ç¡®ä¿åœ¨ <code>gemini.google.com</code> åŸŸåä¸‹æ‰“å¼€æ­¤é¡µé¢<br>` +
                    `2. å°è¯•é€€å‡ºç™»å½•åé‡æ–°ç™»å½•<br>` +
                    `3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡æ–°ç™»å½•`;
                return;
            }

            // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
            statusDiv.className = 'status success';
            statusDiv.innerHTML = 'âœ… æˆåŠŸæå–æ‰€æœ‰å¿…éœ€çš„Cookieï¼';

            // æ˜¾ç¤ºCookieä¿¡æ¯
            let cookieHtml = '<h3>æå–çš„Cookieï¼š</h3>';
            for (const [name, value] of Object.entries(foundCookies)) {
                const preview = value.length > 60 ? value.substring(0, 60) + '...' : value;
                cookieHtml += `
                    <div class="cookie-name">${name}</div>
                    <div class="cookie-value">${preview}</div>
                `;
            }
            cookieInfoDiv.innerHTML = cookieHtml;

            // ç”Ÿæˆcookies.txtæ ¼å¼
            const now = Math.floor(Date.now() / 1000);
            const oneYear = now + (365 * 24 * 60 * 60);

            let cookiesTxt = '# Netscape HTTP Cookie File\n';
            cookiesTxt += '# This is a generated file! Do not edit.\n\n';

            for (const [name, value] of Object.entries(foundCookies)) {
                // æ ¼å¼: domain flag path secure expiration name value
                cookiesTxt += `.google.com\tTRUE\t/\tTRUE\t${oneYear}\t${name}\t${value}\n`;
            }

            cookiesTxtContent.value = cookiesTxt;
            cookiesTxtDiv.style.display = 'block';
        }

        function copyToClipboard() {
            const textarea = document.getElementById('cookiesTxtContent');
            textarea.select();
            document.execCommand('copy');

            alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nä¸‹ä¸€æ­¥ï¼š\n1. ä¿å­˜åˆ°æ–‡ä»¶: cookies.txt\n2. è¿è¡Œéƒ¨ç½²è„šæœ¬: ./deploy-cookies.sh cookies.txt');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
        window.onload = function() {
            const hostname = window.location.hostname;
            if (hostname && !hostname.includes('google.com')) {
                const statusDiv = document.getElementById('status');
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âš ï¸ è­¦å‘Šï¼šå½“å‰ä¸åœ¨ google.com åŸŸåä¸‹<br>' +
                    'è¯·åœ¨BitBrowserä¸­è®¿é—® <a href="https://gemini.google.com" target="_blank">gemini.google.com</a>ï¼Œç„¶åé‡æ–°æ‰“å¼€æ­¤é¡µé¢';
            }
        };
    </script>
</body>
</html>
